# KinmuCore セットアップマニュアル

**バージョン:** 1.0  
**最終更新:** 2026年2月  
**対象:** システム管理者

---

## 目次

1. [システム要件](#システム要件)
2. [初期セットアップ](#初期セットアップ)
3. [管理者ユーザーの作成](#管理者ユーザーの作成)
4. [基本データの登録](#基本データの登録)
5. [タブレットの設定](#タブレットの設定)
6. [セキュリティ設定](#セキュリティ設定)
7. [バックアップと復旧](#バックアップと復旧)

---

## システム要件

### サーバー環境

- **ホスティング:** Vercel（本番環境）
- **データベース:** Supabase（PostgreSQL）
- **リージョン:** Tokyo (hnd1)

### クライアント環境

#### 管理画面
- **OS:** Windows 10以降、macOS 10.15以降
- **ブラウザ:** Chrome、Safari、Edge（最新版）
- **画面解像度:** 1280x720以上推奨

#### 打刻画面（タブレット）
- **OS:** iOS 14以降、Android 9以降
- **ブラウザ:** Safari、Chrome
- **画面サイズ:** 9インチ以上推奨
- **インターネット:** Wi-Fi接続必須

---

## 初期セットアップ

### 1. Supabaseプロジェクトの確認

既にセットアップ済みですが、以下を確認してください：

```
プロジェクトURL: https://gfkrdvdanebsvscefcll.supabase.co
```

#### データベーステーブルの確認

Supabase Dashboard > SQL Editor で以下のテーブルが存在することを確認：

- `stores` - 店舗情報
- `staff` - スタッフ情報
- `policies` - ポリシー（就業ルール）
- `attendance` - 勤怠記録
- `shift_templates` - シフトテンプレート
- `shifts` - シフト予定

### 2. Vercelプロジェクトの確認

**本番環境URL:** https://kinmucore.vercel.app

#### 環境変数の確認

Vercel Dashboard > Settings > Environment Variables で以下が設定されていることを確認：

- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`

### 3. GitHub連携の確認

Vercel Dashboard > Settings > Git で GitHub リポジトリが連携されていることを確認：

- Repository: `morangokei-debug/KinmuCore`
- Branch: `main`
- Auto Deploy: 有効

---

## 管理者ユーザーの作成

### 1. Supabaseでユーザー作成

1. Supabase Dashboard にログイン
2. Authentication > Users に移動
3. 「Add user」をクリック
4. 以下を入力：
   - Email: 管理者のメールアドレス
   - Password: 強固なパスワード（12文字以上推奨）
   - Auto Confirm User: ON
5. 「Create user」をクリック

### 2. 管理者権限の付与

現在、ログイン可能なユーザーは全て管理者権限を持ちます。
将来のバージョンで権限管理機能を追加予定です。

### 3. 初回ログインテスト

1. https://kinmucore.vercel.app/login にアクセス
2. 作成したメールアドレスとパスワードでログイン
3. ダッシュボードが表示されることを確認

---

## 基本データの登録

セットアップ直後は以下の順序でデータを登録します。

### 1. 店舗の登録

1. サイドバー > 「店舗管理」
2. 「+ 新規店舗」をクリック
3. 店舗情報を入力：
   ```
   例：
   店舗名: 本店
   住所: 東京都〇〇区〇〇 1-2-3
   電話番号: 03-1234-5678
   ```
4. 「登録」をクリック

### 2. ポリシーの作成

1. サイドバー > 「ポリシー管理」
2. 「+ 新規ポリシー」をクリック
3. ポリシー情報を入力：
   ```
   例：正社員用ポリシー
   ポリシー名: 正社員標準
   対象店舗: 本店
   締め日: 月末
   丸め単位: 15分単位
   丸め方式: 四捨五入
   休憩控除: 手動（打刻ベース）
   ```
4. 「登録」をクリック

同様にパート・アルバイト用のポリシーも作成することを推奨します。

### 3. スタッフの登録

1. サイドバー > 「スタッフ管理」
2. 「+ 新規スタッフ」をクリック
3. スタッフ情報を入力：
   ```
   例：
   氏名: 山田 太郎
   メールアドレス: yamada@example.com
   所属店舗: 本店
   雇用形態: 正社員
   時給/月給: 250,000（月給の場合）
   入社日: 2024-04-01
   適用ポリシー: 正社員標準
   ```
4. 「登録」をクリック

全スタッフを登録するまで繰り返します。

---

## タブレットの設定

店舗に設置するタブレットの初期設定手順です。

### 1. タブレットの準備

#### 推奨機種
- **iPad:** iPad (第9世代以降) または iPad Air
- **Android:** Samsung Galaxy Tab シリーズ

#### 初期設定
1. Wi-Fiに接続
2. 画面の明るさを最大に設定
3. 自動スリープを「なし」または最長時間に設定
4. 通知をOFFに設定

### 2. 打刻画面URLの取得

1. 管理画面にログイン
2. 「店舗管理」から対象店舗を選択
3. 「打刻ページ」リンクをクリック
4. 表示されたURLをコピー
   ```
   例: https://kinmucore.vercel.app/punch/[店舗ID]
   ```

### 3. ブラウザ設定

#### iOS（Safari）の場合

1. Safari で打刻画面URLを開く
2. 画面下部の「共有」ボタンをタップ
3. 「ホーム画面に追加」をタップ
4. 名前を「勤怠打刻」に変更
5. 「追加」をタップ

これでホーム画面にアプリのようなアイコンが追加されます。

#### Android（Chrome）の場合

1. Chrome で打刻画面URLを開く
2. メニュー（︙）から「ホーム画面に追加」を選択
3. 名前を「勤怠打刻」に変更
4. 「追加」をタップ

### 4. キオスクモード設定（推奨）

タブレットを打刻専用にする場合は、キオスクモード（Guided Access）を設定します。

#### iOS の場合

1. 設定 > アクセシビリティ > ガイドアクセス
2. ガイドアクセスをON
3. パスコードを設定
4. 打刻画面を開いた状態でホームボタンをトリプルクリック
5. ガイドアクセスを開始

#### Android の場合

機種により設定方法が異なるため、「[機種名] キオスクモード」で検索してください。

### 5. タブレット設置

- **設置場所:** 出入口付近、スタッフの目につきやすい場所
- **高さ:** 床から120〜130cm（操作しやすい高さ）
- **充電:** 常時充電ケーブルを接続
- **固定:** タブレットスタンドまたは壁掛けホルダー使用

---

## セキュリティ設定

### 1. パスワードポリシー

管理者ユーザーのパスワードは以下のルールに従ってください：

- 最低12文字以上
- 英大文字、英小文字、数字、記号を含む
- 定期的な変更（3ヶ月ごと推奨）
- 使い回しを避ける

### 2. アクセス制限

#### IPアドレス制限（オプション）

Vercelの有料プランでIPアドレス制限が可能です。
管理画面へのアクセスを特定のIPアドレスのみに制限できます。

#### 二要素認証（将来機能）

現在は未実装ですが、将来のバージョンで対応予定です。

### 3. データの暗号化

- **通信:** すべての通信はHTTPS（TLS 1.3）で暗号化
- **データベース:** Supabaseで自動的に暗号化
- **環境変数:** Vercelで暗号化保存

### 4. 監査ログ

勤怠記録の修正履歴は自動的に記録されます。
不正な操作があった場合、履歴から追跡可能です。

---

## バックアップと復旧

### 1. 自動バックアップ

Supabaseは自動的にデータベースをバックアップします：

- **頻度:** 毎日
- **保持期間:** 7日間（無料プラン）
- **場所:** Supabaseクラウド

### 2. 手動バックアップ

重要な操作の前には手動バックアップを推奨します：

1. Supabase Dashboard にログイン
2. Database > Backups に移動
3. 「Create backup」をクリック

### 3. データのエクスポート

定期的にデータをエクスポートしてローカル保存することを推奨：

1. 管理画面 > データ出力
2. 全期間・全スタッフでExcel出力
3. 安全な場所に保存（月次推奨）

### 4. 復旧手順

データベースに問題が発生した場合：

1. Supabase Dashboard > Database > Backups
2. 復元したいバックアップを選択
3. 「Restore」をクリック
4. 確認後、復元を実行

⚠️ **注意:** 復元すると現在のデータが上書きされます。

---

## トラブルシューティング

### システムが動作しない

#### 1. Vercelのステータス確認

https://vercel.com/morangokei-debugs-projects/kinmucore

デプロイが失敗していないか確認

#### 2. Supabaseのステータス確認

https://supabase.com/dashboard/project/gfkrdvdanebsvscefcll

プロジェクトが正常に動作しているか確認

#### 3. ネットワーク確認

インターネット接続が正常か確認

### データベースエラー

**症状:** 「データベース接続エラー」が表示される

**対処法:**
1. Supabaseプロジェクトのステータスを確認
2. 環境変数が正しいか確認
3. Vercelプロジェクトを再デプロイ

### パフォーマンス問題

**症状:** 画面の表示が遅い

**対処法:**
1. データベースの容量を確認
2. インデックスが正しく設定されているか確認
3. 不要な古いデータを削除

---

## メンテナンス

### 月次メンテナンス

- [ ] データのエクスポート（バックアップ）
- [ ] ディスク容量の確認
- [ ] エラーログの確認
- [ ] アクセス数の確認

### 四半期メンテナンス

- [ ] パスワードの変更
- [ ] 退職済みスタッフのアーカイブ
- [ ] ポリシー設定の見直し
- [ ] システムアップデートの確認

### 年次メンテナンス

- [ ] 前年度データのアーカイブ
- [ ] セキュリティ監査
- [ ] 運用マニュアルの更新

---

## サポート情報

### システム管理者

このマニュアルで解決できない問題が発生した場合は、開発チームにお問い合わせください。

### 技術情報

- **GitHub:** https://github.com/morangokei-debug/KinmuCore
- **Vercel:** https://vercel.com/morangokei-debugs-projects/kinmucore
- **Supabase:** https://supabase.com/dashboard/project/gfkrdvdanebsvscefcll

---

**KinmuCore セットアップマニュアル 終わり**
